const moduleData = [
    {
        name: 'DisableAudioFocus',
        size: '7.74KB',
        version: 'v1.0.0',
        androidRequirement: 'Android 12+',
        publishedBy: 'auag0',
        downloadLink: '#',
        installGuide: `To activate and use an LSPosed module on an Android device, you'll need to ensure LSPosed (part of the Zygisk-based LSPosed Framework) is properly installed and that your module is compatible. Here‚Äôs a step-by-step guide:
‚úÖ Prerequisites:
Rooted device (typically with Magisk)
LSPosed installed (via Magisk module)
LSPosed Manager app installed

üîß Step-by-Step to Activate and Use an LSPosed Module:
1. Install the Module APK
Download and install the LSPosed module (usually an .apk).
Example: GravityBox, AppLocale, YouTube Vanced module, etc.
2. Open LSPosed Manager
Find LSPosed Manager in your app drawer and launch it.
3. Grant Permissions
On first launch, grant any requested permissions (such as root access).
4. Go to the ‚ÄúModules‚Äù Tab
You‚Äôll see all installed modules compatible with LSPosed.
Tap 
5. Activate the Module
Enable the toggle.
Choose which apps the module should hook into (usually System UI, Android, or specific apps depending on the module).
Tap ‚ÄúScope‚Äù and select the apps.
Some modules work system-wide; others target specific apps.
6. Reboot Your Device
Changes won't take effect until you reboot the phone.

üß™ How to Know It‚Äôs Working:
After reboot, open the module‚Äôs app if it has one and configure settings.
Some modules don‚Äôt have a visible UI but modify system behavior or app behavior.

‚ö†Ô∏è Notes:
Only use modules compatible with your Android version.
Some modules might not work correctly if Zygisk or LSPosed is misconfigured.
Always backup your system before using LSPosed modules.`,
        banner: 'assets/DisableAudioFocus.png',
        description: 'This module disables audio focus management, allowing apps to play audio simultaneously without interruptions. Ideal for multitasking with media apps.'
    },
    {
        name: 'DisableFlagSecure (Enable Screenshot bypass)',
        size: '18.53KB',
        version: 'v4.2.0',
        androidRequirement: 'Android 12+',
        publishedBy: 'LSPosed',
        downloadLink: '#',
        installGuide: `To activate and use an LSPosed module on an Android device, you'll need to ensure LSPosed (part of the Zygisk-based LSPosed Framework) is properly installed and that your module is compatible. Here‚Äôs a step-by-step guide:
‚úÖ Prerequisites:
Rooted device (typically with Magisk)
LSPosed installed (via Magisk module)
LSPosed Manager app installed

üîß Step-by-Step to Activate and Use an LSPosed Module:
1. Install the Module APK
Download and install the LSPosed module (usually an .apk).
Example: GravityBox, AppLocale, YouTube Vanced module, etc.
2. Open LSPosed Manager
Find LSPosed Manager in your app drawer and launch it.
3. Grant Permissions
On first launch, grant any requested permissions (such as root access).
4. Go to the ‚ÄúModules‚Äù Tab
You‚Äôll see all installed modules compatible with LSPosed.
Tap 
5. Activate the Module
Enable the toggle.
Choose which apps the module should hook into (usually System UI, Android, or specific apps depending on the module).
Tap ‚ÄúScope‚Äù and select the apps.
Some modules work system-wide; others target specific apps.
6. Reboot Your Device
Changes won't take effect until you reboot the phone.

üß™ How to Know It‚Äôs Working:
After reboot, open the module‚Äôs app if it has one and configure settings.
Some modules don‚Äôt have a visible UI but modify system behavior or app behavior.

‚ö†Ô∏è Notes:
Only use modules compatible with your Android version.
Some modules might not work correctly if Zygisk or LSPosed is misconfigured.
Always backup your system before using LSPosed modules.`,
        banner: 'assets/DisableFlagSecure.png',
        description: 'Bypasses the FLAG_SECURE restriction, enabling screenshots and screen recordings in apps that typically block them, such as banking or streaming apps.'
    },
    {
        name: 'Installer++',
        size: '79.97KB',
        version: 'v1.2.e8c9341',
        androidRequirement: 'Android 12+',
        publishedBy: 'N/A',
        downloadLink: '#',
        installGuide: `To activate and use an LSPosed module on an Android device, you'll need to ensure LSPosed (part of the Zygisk-based LSPosed Framework) is properly installed and that your module is compatible. Here‚Äôs a step-by-step guide:
‚úÖ Prerequisites:
Rooted device (typically with Magisk)
LSPosed installed (via Magisk module)
LSPosed Manager app installed

üîß Step-by-Step to Activate and Use an LSPosed Module:
1. Install the Module APK
Download and install the LSPosed module (usually an .apk).
Example: GravityBox, AppLocale, YouTube Vanced module, etc.
2. Open LSPosed Manager
Find LSPosed Manager in your app drawer and launch it.
3. Grant Permissions
On first launch, grant any requested permissions (such as root access).
4. Go to the ‚ÄúModules‚Äù Tab
You‚Äôll see all installed modules compatible with LSPosed.
Tap 
5. Activate the Module
Enable the toggle.
Choose which apps the module should hook into (usually System UI, Android, or specific apps depending on the module).
Tap ‚ÄúScope‚Äù and select the apps.
Some modules work system-wide; others target specific apps.
6. Reboot Your Device
Changes won't take effect until you reboot the phone.

üß™ How to Know It‚Äôs Working:
After reboot, open the module‚Äôs app if it has one and configure settings.
Some modules don‚Äôt have a visible UI but modify system behavior or app behavior.

‚ö†Ô∏è Notes:
Only use modules compatible with your Android version.
Some modules might not work correctly if Zygisk or LSPosed is misconfigured.
Always backup your system before using LSPosed modules.`,
        banner: 'assets/Installer++.png',
        description: 'Enhances the default app installer with additional features like batch installation, APK signing, and advanced installation options for power users.'
    },
    {
        name: 'OxygenCustomizer',
        size: '51.88MB',
        version: 'nightly-11 (#911)(11)',
        androidRequirement: 'Android 12+',
        publishedBy: 'N/A',
        downloadLink: '#',
        installGuide: `To activate and use an LSPosed module on an Android device, you'll need to ensure LSPosed (part of the Zygisk-based LSPosed Framework) is properly installed and that your module is compatible. Here‚Äôs a step-by-step guide:
‚úÖ Prerequisites:
Rooted device (typically with Magisk)
LSPosed installed (via Magisk module)
LSPosed Manager app installed

üîß Step-by-Step to Activate and Use an LSPosed Module:
1. Install the Module APK
Download and install the LSPosed module (usually an .apk).
Example: GravityBox, AppLocale, YouTube Vanced module, etc.
2. Open LSPosed Manager
Find LSPosed Manager in your app drawer and launch it.
3. Grant Permissions
On first launch, grant any requested permissions (such as root access).
4. Go to the ‚ÄúModules‚Äù Tab
You‚Äôll see all installed modules compatible with LSPosed.
Tap 
5. Activate the Module
Enable the toggle.
Choose which apps the module should hook into (usually System UI, Android, or specific apps depending on the module).
Tap ‚ÄúScope‚Äù and select the apps.
Some modules work system-wide; others target specific apps.
6. Reboot Your Device
Changes won't take effect until you reboot the phone.

üß™ How to Know It‚Äôs Working:
After reboot, open the module‚Äôs app if it has one and configure settings.
Some modules don‚Äôt have a visible UI but modify system behavior or app behavior.

‚ö†Ô∏è Notes:
Only use modules compatible with your Android version.
Some modules might not work correctly if Zygisk or LSPosed is misconfigured.
Always backup your system before using LSPosed modules.`,
        banner: 'assets/OxygenCustomizer.png',
        description: 'A customization module for OxygenOS (OnePlus devices) that unlocks hidden features, tweaks UI elements, and adds new functionalities to the system.'
    },
    {
        name: 'WiFiList',
        size: '3.37MB',
        version: 'v1.3.2',
        androidRequirement: 'N/A',
        publishedBy: 'Zachary Wander',
        downloadLink: '#',
        installGuide: `To activate and use an LSPosed module on an Android device, you'll need to ensure LSPosed (part of the Zygisk-based LSPosed Framework) is properly installed and that your module is compatible. Here‚Äôs a step-by-step guide:
‚úÖ Prerequisites:
Rooted device (typically with Magisk)
LSPosed installed (via Magisk module)
LSPosed Manager app installed

üîß Step-by-Step to Activate and Use an LSPosed Module:
1. Install the Module APK
Download and install the LSPosed module (usually an .apk).
Example: GravityBox, AppLocale, YouTube Vanced module, etc.
2. Open LSPosed Manager
Find LSPosed Manager in your app drawer and launch it.
3. Grant Permissions
On first launch, grant any requested permissions (such as root access).
4. Go to the ‚ÄúModules‚Äù Tab
You‚Äôll see all installed modules compatible with LSPosed.
Tap 
5. Activate the Module
Enable the toggle.
Choose which apps the module should hook into (usually System UI, Android, or specific apps depending on the module).
Tap ‚ÄúScope‚Äù and select the apps.
Some modules work system-wide; others target specific apps.
6. Reboot Your Device
Changes won't take effect until you reboot the phone.

üß™ How to Know It‚Äôs Working:
After reboot, open the module‚Äôs app if it has one and configure settings.
Some modules don‚Äôt have a visible UI but modify system behavior or app behavior.

‚ö†Ô∏è Notes:
Only use modules compatible with your Android version.
Some modules might not work correctly if Zygisk or LSPosed is misconfigured.
Always backup your system before using LSPosed modules.`,
        banner: 'assets/WiFiList.png',
        description: 'Provides detailed information about available Wi-Fi networks, including signal strength, encryption type, and channel, for advanced network management.'
    },
    {
        name: 'xDowngrader',
        size: '76.26KB',
        version: 'v1.1',
        androidRequirement: 'Android 12+',
        publishedBy: 'Xposed Modules Repository',
        downloadLink: '#',
        installGuide: `To activate and use an LSPosed module on an Android device, you'll need to ensure LSPosed (part of the Zygisk-based LSPosed Framework) is properly installed and that your module is compatible. Here‚Äôs a step-by-step guide:
‚úÖ Prerequisites:
Rooted device (typically with Magisk)
LSPosed installed (via Magisk module)
LSPosed Manager app installed

üîß Step-by-Step to Activate and Use an LSPosed Module:
1. Install the Module APK
Download and install the LSPosed module (usually an .apk).
Example: GravityBox, AppLocale, YouTube Vanced module, etc.
2. Open LSPosed Manager
Find LSPosed Manager in your app drawer and launch it.
3. Grant Permissions
On first launch, grant any requested permissions (such as root access).
4. Go to the ‚ÄúModules‚Äù Tab
You‚Äôll see all installed modules compatible with LSPosed.
Tap 
5. Activate the Module
Enable the toggle.
Choose which apps the module should hook into (usually System UI, Android, or specific apps depending on the module).
Tap ‚ÄúScope‚Äù and select the apps.
Some modules work system-wide; others target specific apps.
6. Reboot Your Device
Changes won't take effect until you reboot the phone.

üß™ How to Know It‚Äôs Working:
After reboot, open the module‚Äôs app if it has one and configure settings.
Some modules don‚Äôt have a visible UI but modify system behavior or app behavior.

‚ö†Ô∏è Notes:
Only use modules compatible with your Android version.
Some modules might not work correctly if Zygisk or LSPosed is misconfigured.
Always backup your system before using LSPosed modules.`,
        banner: 'assets/XDowngrader.png',
        description: 'Allows downgrading apps to previous versions, bypassing version restrictions imposed by the Play Store or system updates.'
    },
    {
        name: 'WiFiList',
        size: '3.37MB',
        version: 'v1.3.2',
        androidRequirement: 'N/A',
        publishedBy: 'Zachary Wander',
        downloadLink: '#',
        installGuide: `To activate and use an LSPosed module on an Android device, you'll need to ensure LSPosed (part of the Zygisk-based LSPosed Framework) is properly installed and that your module is compatible. Here‚Äôs a step-by-step guide:
‚úÖ Prerequisites:
Rooted device (typically with Magisk)
LSPosed installed (via Magisk module)
LSPosed Manager app installed

üîß Step-by-Step to Activate and Use an LSPosed Module:
1. Install the Module APK
Download and install the LSPosed module (usually an .apk).
Example: GravityBox, AppLocale, YouTube Vanced module, etc.
2. Open LSPosed Manager
Find LSPosed Manager in your app drawer and launch it.
3. Grant Permissions
On first launch, grant any requested permissions (such as root access).
4. Go to the ‚ÄúModules‚Äù Tab
You‚Äôll see all installed modules compatible with LSPosed.
Tap 
5. Activate the Module
Enable the toggle.
Choose which apps the module should hook into (usually System UI, Android, or specific apps depending on the module).
Tap ‚ÄúScope‚Äù and select the apps.
Some modules work system-wide; others target specific apps.
6. Reboot Your Device
Changes won't take effect until you reboot the phone.

üß™ How to Know It‚Äôs Working:
After reboot, open the module‚Äôs app if it has one and configure settings.
Some modules don‚Äôt have a visible UI but modify system behavior or app behavior.

‚ö†Ô∏è Notes:
Only use modules compatible with your Android version.
Some modules might not work correctly if Zygisk or LSPosed is misconfigured.
Always backup your system before using LSPosed modules.`,
        banner: 'assets/WiFiList.png',
        description: 'Provides detailed information about available Wi-Fi networks, including signal strength, encryption type, and channel, for advanced network management.'
    },
    {
        name: 'DevOptsHide',
        size: '557KB',
        version: 'v3.0',
        androidRequirement: 'Android 12+',
        publishedBy: 'accelforce',
        downloadLink: '#',
        installGuide: `To activate and use an LSPosed module on an Android device, you'll need to ensure LSPosed (part of the Zygisk-based LSPosed Framework) is properly installed and that your module is compatible. Here‚Äôs a step-by-step guide:
‚úÖ Prerequisites:
Rooted device (typically with Magisk)
LSPosed installed (via Magisk module)
LSPosed Manager app installed

üîß Step-by-Step to Activate and Use an LSPosed Module:
1. Install the Module APK
Download and install the LSPosed module (usually an .apk).
Example: GravityBox, AppLocale, YouTube Vanced module, etc.
2. Open LSPosed Manager
Find LSPosed Manager in your app drawer and launch it.
3. Grant Permissions
On first launch, grant any requested permissions (such as root access).
4. Go to the ‚ÄúModules‚Äù Tab
You‚Äôll see all installed modules compatible with LSPosed.
Tap 
5. Activate the Module
Enable the toggle.
Choose which apps the module should hook into (usually System UI, Android, or specific apps depending on the module).
Tap ‚ÄúScope‚Äù and select the apps.
Some modules work system-wide; others target specific apps.
6. Reboot Your Device
Changes won't take effect until you reboot the phone.

üß™ How to Know It‚Äôs Working:
After reboot, open the module‚Äôs app if it has one and configure settings.
Some modules don‚Äôt have a visible UI but modify system behavior or app behavior.

‚ö†Ô∏è Notes:
Only use modules compatible with your Android version.
Some modules might not work correctly if Zygisk or LSPosed is misconfigured.
Always backup your system before using LSPosed modules.`,
        banner: 'assets/DevOptsHide.png',
        description: 'Shows enabled developer options as disabled per app'
    },
];

// Add debug logging
console.log('Module data count:', moduleData.length);

// DOM elements
const romGrid = document.querySelector('.rom-grid');
const searchInput = document.getElementById('search-input');
const searchButton = document.getElementById('search-button');

// Add modal overlay for module description
function createDescriptionModal() {
    if (document.getElementById('rom-desc-modal')) return;
    const modal = document.createElement('div');
    modal.id = 'rom-desc-modal';
    modal.innerHTML = `
        <div class="rom-desc-modal-backdrop"></div>
        <div class="rom-desc-modal-content">
            <div class="rom-desc-modal-header">
                <button class="rom-desc-modal-close">&times;</button>
            </div>
            <div class="rom-desc-modal-body"></div>
        </div>
    `;
    document.body.appendChild(modal);
    // Close on backdrop or close button
    modal.querySelector('.rom-desc-modal-backdrop').onclick = closeDescriptionModal;
    modal.querySelector('.rom-desc-modal-close').onclick = closeDescriptionModal;
}

function openDescriptionModal(html) {
    createDescriptionModal();
    const modal = document.getElementById('rom-desc-modal');
    modal.style.display = 'flex';
    modal.querySelector('.rom-desc-modal-body').innerHTML = html;
    document.body.style.overflow = 'hidden';
    // Animate blur in
    const backdrop = modal.querySelector('.rom-desc-modal-backdrop');
    backdrop.classList.remove('closing');
    setTimeout(() => backdrop.classList.add('active'), 10);
}

function closeDescriptionModal() {
    const modal = document.getElementById('rom-desc-modal');
    if (!modal) return;
    const content = modal.querySelector('.rom-desc-modal-content');
    const backdrop = modal.querySelector('.rom-desc-modal-backdrop');
    if (backdrop) {
        backdrop.classList.remove('active');
        backdrop.classList.add('closing');
    }
    if (content) {
        content.classList.add('closing');
        content.addEventListener('animationend', function handler() {
            content.classList.remove('closing');
            modal.style.display = 'none';
            document.body.style.overflow = '';
            content.removeEventListener('animationend', handler);
            if (backdrop) backdrop.classList.remove('closing');
        });
    } else {
        modal.style.display = 'none';
        document.body.style.overflow = '';
        if (backdrop) backdrop.classList.remove('closing');
    }
}

// Function to render module cards
function renderModuleCards(modules = moduleData) {
    romGrid.innerHTML = '';
    
    modules.forEach(module => {
        const moduleCard = document.createElement('div');
        moduleCard.className = 'rom-card';
        const bannerPath = module.banner || 'assets/LineageOS.png';
        let updatedLine = '';
        if (module.updated) {
            updatedLine = `<p><strong>Updated:</strong> ${module.updated}</p>`;
        }
        moduleCard.innerHTML = `
            <img src="${bannerPath}" alt="${module.name} banner" class="rom-banner" onerror="this.onerror=null;this.src='assets/LineageOS.png';">
            <h3>${module.name}</h3>
            <p><strong>Size:</strong> ${module.size || 'N/A'}</p>
            <p><strong>Version:</strong> ${module.version || 'N/A'}</p>
            <p><strong>Android Requirement:</strong> ${module.androidRequirement || 'N/A'}</p>
            <p><strong>Published by:</strong> ${module.publishedBy || 'N/A'}</p>
            <button class="desc-toggle">Show Description</button>
            <div class="rom-actions">
                <a href="${module.downloadLink}" class="download-btn">Download</a>
                <button class="instructions-btn">Install Guide</button>
            </div>
        `;
        romGrid.appendChild(moduleCard);
        // Add event for description modal
        moduleCard.querySelector('.desc-toggle').onclick = function() {
            const bannerImg = `<img src="${bannerPath}" alt="${module.name} banner" class="rom-modal-banner" onerror="this.onerror=null;this.src='assets/LineageOS.png';">`;
            openDescriptionModal(`${bannerImg}<h3>${module.name}</h3><div>${module.description.replace(/\n/g, '<br>')}</div>`);
        };
        // Add event for install guide modal
        moduleCard.querySelector('.instructions-btn').onclick = function() {
            const guideText = '<h1 style="background: linear-gradient(to right, #ffd700, #ff8c00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-top: 0;">Install Guide</h1>';
            openDescriptionModal(`${guideText}<h3>${module.name}</h3><div>${module.installGuide.replace(/\n/g, '<br>')}</div>`);
        };
    });
}

// Function to handle search
function handleSearch(query) {
    const filteredModules = moduleData.filter(module => 
        module.name.toLowerCase().includes(query.toLowerCase()) ||
        module.publishedBy.toLowerCase().includes(query.toLowerCase())
    );
    renderModuleCards(filteredModules);
}

// Initialize the page
function init() {
    renderModuleCards();
    
    // Search functionality
    searchButton.addEventListener('click', () => {
        handleSearch(searchInput.value);
    });
    
    searchInput.addEventListener('keyup', () => {
        handleSearch(searchInput.value);
    });
}

// Start the application
init();

// Ensure DOM is fully loaded before running the script
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM fully loaded, rendering cards');
    renderModuleCards();
});

// Fallback in case DOM is already loaded
if (document.readyState === 'complete') {
    console.log('DOM already loaded, rendering immediately');
    renderModuleCards();
}

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        const href = this.getAttribute('href');
        // Check if the href is one of the sections to redirect to index.html
        if (href === '#roms' || href === '#guides' || href === '#device-info') {
            e.preventDefault();
            window.location.href = `index.html${href}`;
        } else {
            e.preventDefault();
            document.querySelector(href).scrollIntoView({
                behavior: 'smooth'
            });
        }
    });
});

// Smooth page transition for navigation links
document.querySelectorAll('a[href^="/"]').forEach(link => {
    link.addEventListener('click', function (e) {
        e.preventDefault();
        document.body.classList.add('fade-out');
        setTimeout(() => {
            window.location.href = this.getAttribute('href');
        }, 500); // Match this duration with the CSS animation duration
    });
});
